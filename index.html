<html>
<title>gym_session</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<body>
<input id="randb" type="button" style="font-size: 18px" value="Random workout">
<div id="options"></div>
<div id="functionality"></div>
</body>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="gym_moves.js"></script>

<script>
   // wait document to load up before doing anything, can use also $(function(){
   $(document).ready(function() {
   
      var maxmoves = 10
   
      // generate buttons
      // var optionstr = "";
      //for (i = 0; i < window.series.length; i++) {
         //optionstr += "<input id=\"rb" + i + "\" type=\"button\" value=\"" + window.series[i] + "\">";
      //}
      //document.getElementById("options").innerHTML = optionstr;
   
   
      // clickfunction for randomizer button
      $("#randb").click(function validateForm() {
         $("#functionality").hide(700, randbutton_hide_callback)
      });
      
      function randbutton_hide_callback() {
         // make a temporary copy of all moves that we will cut down
         var available_moves = window.moves.slice()
         
         // random how many moves to do today
         var howmany = rand_int(maxmoves) // here +1 if not want a rest day
         
         // how many different series are found (ascending in intensity)
         var intensity_level_count = window.series.length
         var session_moves = []
         var session_intensity_levels = []
         
         // generate workout, randomize moves and intensity levels
         for (i = 0; i < howmany; i++) {
            var selected_move = rand_int(available_moves.length)
            session_moves.push(available_moves[selected_move])
            session_intensity_levels.push(rand_int(intensity_level_count))
            available_moves.splice(selected_move, 1)
         }

         // calculate muscle coverage things
         var all_muscles = calc_unique_elements(window.moves)
         var muscles_in_session = calc_unique_elements(session_moves)
         var coverage = muscles_in_session.length/all_muscles.length
      
         // print page
         var pagestr = "<br><table>"
         

         for (i = 0; i < session_moves.length; i++) {
            pagestr += "<tr><td>"
            pagestr += window.series[session_intensity_levels[i]]
            pagestr += "</td><td>"
            pagestr += session_moves[i][0]
            pagestr += "</td></tr>"
         }
         pagestr += "</table>"
         if (howmany ==0){
            pagestr += "REST! Go to McDonalds."
         }
         
         pagestr += "<br><br>"
         pagestr += "Muscles in this session:<br>"
         pagestr += print_list(muscles_in_session)
         pagestr += "<br><br>"
         pagestr += "All muscles in database:<br>"
         pagestr += print_list(all_muscles)
         pagestr += "<br><br>"
         pagestr += "Muscle coverage: " + Math.floor(coverage*100).toString() + "%"
         pagestr += "<br>"
         pagestr += "Intensity: " + calculate_intensity(maxmoves, session_intensity_levels, intensity_level_count).toString() + "%"
         
         document.getElementById("functionality").innerHTML = pagestr
         
         $("#functionality").show(700)
      }
      
      function calculate_intensity(maxmoves, intensity_levels, intensity_level_count) {
         // calculates the intensity, how many series and how intense they are from max
         
         var sum_intensity = 0
         for (i = 0; i < intensity_levels.length; i++) {
            sum_intensity += intensity_levels[i] + 1
         }
         
         return Math.floor(sum_intensity*100/((maxmoves-1)*intensity_level_count))
      }
      
      function rand_int(parameterint) {
         // return random integer from 0..parameterint-1
         return Math.floor((Math.random() * parameterint))
      }
      
      function calc_unique_elements(movelist) {
         // Return list of unique elements appear in the list
         
         var all_elements = []
         for (i = 0; i < movelist.length; i++) {
            all_elements = all_elements.concat(movelist[i][1])
         }
      
         // calculate all unique elements
         return(Array.from(new Set(all_elements)))
      }
      
      function print_list(list_to_print) {
         // return a string of a list so that there is break between elements
         var print_literal = ""
         for (i = 0; i < list_to_print.length; i++) {
            print_literal += list_to_print[i] + " "
         }
         return print_literal
      }

   });
</script>
</html>